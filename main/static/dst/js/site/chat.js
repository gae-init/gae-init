// Generated by CoffeeScript 1.3.1
(function() {
  var leading_zero, send_chat_message;

  window.subscribe_chat = function() {
    var channel;
    channel = $('html').data('channel-name');
    subscribe_channel(channel, on_chat_message_received);
    $('.chat-message').select();
    $('body').on('click', '.chat-send', function() {
      return send_chat_message();
    });
    return $('body').on('keydown', '.chat-message', function(event) {
      if (event.keyCode === 13) {
        return send_chat_message();
      }
    });
  };

  send_chat_message = function() {
    var channel, message;
    channel = $('html').data('channel-name');
    message = $('.chat-message').val();
    $('.chat-message').val('');
    if (message) {
      return channel_send(channel, {
        'name': $('.chat-message').data('name'),
        'message': message,
        'time': new Date().getTime()
      });
    }
  };

  window.on_chat_message_received = function(message) {
    var time, timestamp;
    time = new Date(message.time);
    timestamp = "" + (leading_zero(time.getHours())) + ":" + (leading_zero(time.getMinutes())) + ":" + (leading_zero(time.getSeconds()));
    return $('.chat-log').prepend("<hr>\n<h3>" + message.name + " <small> @ " + timestamp + "</small></h3>\n<h4>" + message.message + "</h4>");
  };

  leading_zero = function(number) {
    if (number < 10) {
      return '0' + number;
    }
    return number;
  };

}).call(this);
