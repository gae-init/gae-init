(function(){var a,b;window.LOG=function(a){if(!window.console)return;if(!window.console.log)return;if(arguments.length===0)return;return arguments.length===1?window.console.log(arguments[0]):arguments.length===2?window.console.log(arguments[0],arguments[1]):arguments.length===3?window.console.log(arguments[0],arguments[1],arguments[2]):arguments.length===4?window.console.log(arguments[0],arguments[1],arguments[2],arguments[3]):arguments.length===5?window.console.log(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]):window.console.log("Too many arguments to LOG function")},window.service_call=function(a,b,c,d,e,f){var g,h;f=f||e||d||c,e=e||d||c,d=d||c,f===e&&(f=void 0),arguments.length===4&&(d=void 0),arguments.length===3&&(c=void 0,d=void 0),c=c||{};for(g in c)h=c[g],h==null&&delete c[g];return $.ajax({type:a,url:b+"?"+$.param(c),contentType:"application/json",accepts:"application/json",dataType:"json",data:d?JSON.stringify(d):void 0,progress:f,success:function(d){var f;return d.status==="success"?(f=void 0,d.more_cursor&&(c.cursor=d.more_cursor,f=function(d){return service_call(a,b,c,d)}),e(void 0,d.result,f)):e(d)},error:function(a,b,c){var d;d={error_code:"ajax_error",text_status:b,error_thrown:c,jqXHR:a};try{a.responseText&&(d=$.parseJSON(a.responseText))}catch(f){d=d}return LOG("service call error",d),e(d)}})},window.init_loading_button=function(){return $("body").on("click",".btn-loading",function(){return $(this).button("loading")})},window.channel_get=function(){return window.PUBNUB_PUBLISH&&window.PUBNUB_SUBSCRIBE?PUBNUB({publish_key:window.PUBNUB_PUBLISH,subscribe_key:window.PUBNUB_SUBSCRIBE,ssl:!1,origin:"pubsub.pubnub.com"}):null},window.subscribe_channel=function(a,b){var c;return c=channel_get(),LOG("sdf",c),c?(c.subscribe({channel:a,connect:null,callback:b||null}),!0):!1},window.channel_send=function(a,b,c){var d;return d=channel_get(),d?(d.publish({channel:a,message:b,callback:c||null}),!0):!1},window.channel_history=function(a,b,c){var d;d=channel_get();if(d)return d.history({channel:a,limit:b},c||null)},$(function(){return LOG("app init")}),$(function(){return $("html.welcome").each(function(){return LOG("init welcome")})}),$(function(){return $("html.profile").each(function(){return init_profile()})}),$(function(){return $("html.admin-config").each(function(){return init_admin_config()})}),$(function(){var a;a=$("html").data("channel-name");if(a==="chat")return subscribe_chat()}),window.init_profile=function(){return init_loading_button()},window.init_admin_config=function(){return init_loading_button()},window.subscribe_chat=function(){var a;return a=$("html").data("channel-name"),subscribe_channel(a,on_chat_message_received),channel_history(a,16,on_chat_history),$(".chat-message").select(),$("body").on("click",".chat-send",function(){return b()}),$("body").on("keydown",".chat-message",function(a){if(a.keyCode===13)return b()})},b=function(){var a,b;a=$("html").data("channel-name"),b=$(".chat-message").val(),$(".chat-message").val("");if(b)return channel_send(a,{name:$(".chat-message").data("name"),message:b,time:(new Date).getTime()})},window.on_chat_message_received=function(b){var c,d;return c=new Date(b.time),d=""+a(c.getHours())+":"+a(c.getMinutes())+":"+a(c.getSeconds()),$(".chat-log").prepend("<hr>\n<h3>"+b.name+" <small> @ "+d+"</small></h3>\n<h4>"+b.message+"</h4>")},window.on_chat_history=function(a){var b,c,d,e;e=[];for(c=0,d=a.length;c<d;c++)b=a[c],e.push(on_chat_message_received(b));return e},a=function(a){return a<10?"0"+a:a}}).call(this);