(function(){var e,t;window.LOG=function(e){if(!window.console)return;if(!window.console.log)return;if(arguments.length===0)return;return arguments.length===1?window.console.log(arguments[0]):arguments.length===2?window.console.log(arguments[0],arguments[1]):arguments.length===3?window.console.log(arguments[0],arguments[1],arguments[2]):arguments.length===4?window.console.log(arguments[0],arguments[1],arguments[2],arguments[3]):arguments.length===5?window.console.log(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]):window.console.log("Too many arguments to LOG function")},window.service_call=function(e,t,n,r,i,s){var o,u;s=s||i||r||n,i=i||r||n,r=r||n,s===i&&(s=void 0),arguments.length===4&&(r=void 0),arguments.length===3&&(n=void 0,r=void 0),n=n||{};for(o in n)u=n[o],u==null&&delete n[o];return $.ajax({type:e,url:t+"?"+$.param(n),contentType:"application/json",accepts:"application/json",dataType:"json",data:r?JSON.stringify(r):void 0,progress:s,success:function(t){var n;return t.status==="success"?(n=void 0,t.more_url&&(n=function(n){return service_call(e,t.more_url,{},n)}),i(void 0,t.result,n)):i(t)},error:function(e,t,n){var r;r={error_code:"ajax_error",text_status:t,error_thrown:n,jqXHR:e};try{e.responseText&&(r=$.parseJSON(e.responseText))}catch(s){r=r}return LOG("service call error",r),i(r)}})},window.init_loading_button=function(){return $("body").on("click",".btn-loading",function(){return $(this).button("loading")})},window.channel_get=function(){return window.PUBNUB_PUBLISH&&window.PUBNUB_SUBSCRIBE?PUBNUB({publish_key:window.PUBNUB_PUBLISH,subscribe_key:window.PUBNUB_SUBSCRIBE,ssl:!1,origin:"pubsub.pubnub.com"}):null},window.subscribe_channel=function(e,t){var n;return n=channel_get(),n?(n.subscribe({channel:e,restore:!0,connect:function(){return LOG("Connected to",e)},disconnect:function(){return LOG("Disconnected from",e)},reconnect:function(){return LOG("Reconnected to",e)},callback:t||null}),!0):!1},window.channel_send=function(e,t,n){var r;return r=channel_get(),r?(r.publish({channel:e,message:t,callback:n||null}),!0):!1},window.channel_history=function(e,t,n){var r;r=channel_get();if(r)return r.history({channel:e,limit:t},n||null)},$(function(){return LOG("app init")}),$(function(){return $("html.welcome").each(function(){return LOG("init welcome")})}),$(function(){return $("html.profile").each(function(){return init_profile()})}),$(function(){return $("html.feedback").each(function(){return init_loading_button()})}),$(function(){return $("html.admin-config").each(function(){return init_admin_config()})}),$(function(){var e;e=$("html").data("channel-name");if(e==="chat")return subscribe_chat()}),window.init_profile=function(){return init_loading_button()},window.init_admin_config=function(){return init_loading_button()},window.subscribe_chat=function(){var e;return e=$("html").data("channel-name"),subscribe_channel(e,on_chat_message_received),channel_history(e,8,on_chat_history),$(".chat-message").select(),$("body").on("click",".chat-send",function(){return t()}),$("body").on("keydown",".chat-message",function(e){if(e.keyCode===13)return t()})},t=function(){var e,t;e=$("html").data("channel-name"),t=$(".chat-message").val(),$(".chat-message").val("");if(t)return channel_send(e,{name:$(".chat-message").data("name"),message:t,time:(new Date).getTime()})},window.on_chat_message_received=function(t){var n,r;return n=new Date(t.time),r=""+e(n.getHours())+":"+e(n.getMinutes())+":"+e(n.getSeconds()),$(".chat-log").prepend("<hr>\n<h4>"+t.name+" <small> @ "+r+"</small></h4>\n<h5>"+t.message+"</h5>")},window.on_chat_history=function(e){var t,n,r,i;i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(on_chat_message_received(t));return i},e=function(e){return e<10?"0"+e:e}}).call(this);